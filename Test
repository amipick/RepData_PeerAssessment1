```r
rm(list=ls())
library(data.table)
data <- read.table("activity.csv", header=T, sep=",")
library(sqldf)
### 1st Step > remove na
data1 <- sqldf("select date,sum(steps) as total_steps from data where steps is not null group by 1")
hist(data1$total_steps, col="red", xlab="Total Steps", main="Total Steps per Day")
MeanSteps <- mean(data1$total_steps) ## 10766.2
MedianSteps <- median(data1$total_steps) ### 10765
### 2nd Step
data2 <- sqldf("select interval as intervalKey, avg(steps) as averageSteps from data where steps is not null group by 1")
library(ggplot2)
ggplot(data2, aes(x=intervalKey)) + geom_line(aes(y=averageSteps)) + labs(y="Average # of Steps", x="Interval") + ggtitle("Avg. Daily Steps")
maxSteps <- max(data2$averageSteps) ## find max steps
maxInterval <- data2[data2$averageSteps == maxSteps,] ### find max interval
print(maxInterval$interval) ## print max Interval
###### 3rd Step
missing_values <- sqldf("select count(*) as steps from data where steps is null")
print (missing_values) ###2304
data$steps <- as.numeric(data$steps)
data3 <- sqldf("select data.date,data.interval, case when steps is null then averageSteps else steps end as steps from data inner join data2 on data.interval=data2.intervalKey")
data4 <- sqldf("select date,sum(steps) as totalSteps from data3 where steps is not null group by 1")
hist(data4$totalSteps, col="blue", xlab="Total Steps", main="Total Steps per Day")
meanSteps_new <- mean(data4$totalSteps) ## 10766.2
medianSteps_new <- median(data4$totalSteps) ### 10766.2
### 4th step
data5 <- sqldf("select case when strftime('%w', date) in ('0','6') then 'WeekEnd' else 'WeekDay' end as dayType, interval, avg(steps) as avgSteps from data3 group by 1,2")
ggplot(data5, aes(x=interval)) + geom_line(aes(y=avgSteps), col="blue") + facet_wrap(~dayType, ncol=1) +
labs(y="Average # of Steps", x="Interval")
```
